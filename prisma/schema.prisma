generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

enum UserRole {
  ADMIN
  USER
  DATA_ENTRY
  CLIENT_USER
}

enum MediaType {
  WEB
  TV
  RADIO
  PRINT
}

// User Management
model User {
  id        String   @id @default(cuid())
  email     String   @unique
  password  String
  name      String
  role      UserRole @default(USER)
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  clientId String?
  client   Client? @relation(fields: [clientId], references: [id])

  webStories      WebStory[]
  tvStories       TVStory[]
  radioStories    RadioStory[]
  printStories    PrintStory[]
  socialPosts     SocialPost[]
  articleViewLogs ArticleViewLog[]
  mediaEntryLogs  MediaEntryLog[]
  visitLogs       VisitLog[]
  tenderViewLogs  TenderViewLog[]
}

// Client Management
model Client {
  id             String    @id @default(cuid())
  name           String
  email          String?
  phone          String?
  address        String?
  postalAddress  String?
  webAddress     String?
  contactPerson  String?
  logoUrl        String?
  expiryDate     DateTime?
  isActive       Boolean   @default(true)
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt

  // News update config
  newsEmailAlerts Boolean @default(false)
  newsSmsAlerts   Boolean @default(false)
  newsKeywords    String?

  // Tender update config
  tenderEmailAlerts Boolean @default(false)
  tenderSmsAlerts   Boolean @default(false)
  tenderKeywords    String?

  users               User[]
  industries          ClientIndustry[]
  keywords            ClientKeyword[]
  articleViewLogs     ArticleViewLog[]
  competitors         ClientCompetitor[] @relation("ClientCompetitors")
  competitorOf        ClientCompetitor[] @relation("CompetitorOf")
  dailyInsights       DailyInsight[]
  socialPosts         SocialPost[]
}

// Competitor Tracking
model ClientCompetitor {
  id                 String   @id @default(cuid())
  clientId           String
  client             Client   @relation("ClientCompetitors", fields: [clientId], references: [id], onDelete: Cascade)
  competitorClientId String?  // If competitor is also a client
  competitorClient   Client?  @relation("CompetitorOf", fields: [competitorClientId], references: [id], onDelete: Cascade)
  competitorName     String?  // If competitor is not a client
  competitorKeywords String?  // Keywords to track for this competitor
  isActive           Boolean  @default(true)
  createdAt          DateTime @default(now())
  updatedAt          DateTime @updatedAt

  @@unique([clientId, competitorClientId])
  @@index([clientId])
}

// Keyword Management
model Keyword {
  id        String   @id @default(cuid())
  name      String   @unique
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  clients ClientKeyword[]
}

model ClientKeyword {
  id        String   @id @default(cuid())
  clientId  String
  client    Client   @relation(fields: [clientId], references: [id], onDelete: Cascade)
  keywordId String
  keyword   Keyword  @relation(fields: [keywordId], references: [id], onDelete: Cascade)
  createdAt DateTime @default(now())

  @@unique([clientId, keywordId])
}

// Industry Classification
model Industry {
  id        String   @id @default(cuid())
  name      String   @unique
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  subIndustries SubIndustry[]
  clients       ClientIndustry[]
  webStories    WebStory[]
  tvStories     TVStory[]
  radioStories  RadioStory[]
  printStories  PrintStory[]
  socialPosts   SocialPost[]
}

model SubIndustry {
  id         String   @id @default(cuid())
  name       String
  industryId String
  industry   Industry @relation(fields: [industryId], references: [id], onDelete: Cascade)
  isActive   Boolean  @default(true)
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  webStories    WebStorySubIndustry[]
  tvStories     TVStorySubIndustry[]
  radioStories  RadioStorySubIndustry[]
  printStories  PrintStorySubIndustry[]
  socialPosts   SocialPostSubIndustry[]

  @@unique([name, industryId])
}

model ClientIndustry {
  id         String   @id @default(cuid())
  clientId   String
  client     Client   @relation(fields: [clientId], references: [id], onDelete: Cascade)
  industryId String
  industry   Industry @relation(fields: [industryId], references: [id], onDelete: Cascade)
  createdAt  DateTime @default(now())

  @@unique([clientId, industryId])
}

// Web Publications
model WebPublication {
  id           String   @id @default(cuid())
  name         String   @unique
  website      String?
  location     String?  // Location/City
  reach        Int      @default(0) // Monthly unique visitors
  region       String?  // Geographic region
  isActive     Boolean  @default(true)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  stories WebStory[]
}

// TV Stations and Programs
model TVStation {
  id        String   @id @default(cuid())
  name      String   @unique
  location  String?  // Location/City
  reach     Int      @default(0) // Average viewership
  region    String?  // Geographic region
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  programs TVProgram[]
  stories  TVStory[]
}

model TVProgram {
  id        String    @id @default(cuid())
  name      String
  stationId String
  station   TVStation @relation(fields: [stationId], references: [id], onDelete: Cascade)
  startTime String?   // e.g., "06:00"
  endTime   String?   // e.g., "09:00"
  isActive  Boolean   @default(true)
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt

  stories TVStory[]

  @@unique([name, stationId])
}

// Radio Stations and Programs
model RadioStation {
  id        String   @id @default(cuid())
  name      String   @unique
  frequency String?
  location  String?  // Location/City
  reach     Int      @default(0) // Average listenership
  region    String?  // Geographic region
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  programs RadioProgram[]
  stories  RadioStory[]
}

model RadioProgram {
  id        String       @id @default(cuid())
  name      String
  stationId String
  station   RadioStation @relation(fields: [stationId], references: [id], onDelete: Cascade)
  startTime String?      // e.g., "06:00"
  endTime   String?      // e.g., "09:00"
  isActive  Boolean      @default(true)
  createdAt DateTime     @default(now())
  updatedAt DateTime     @updatedAt

  stories RadioStory[]

  @@unique([name, stationId])
}

// Print Publications and Issues
model PrintPublication {
  id          String   @id @default(cuid())
  name        String   @unique
  location    String?  // Location/City
  reach       Int      @default(0) // Daily/weekly circulation (readership)
  region      String?  // Geographic region
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  issues  PrintIssue[]
  stories PrintStory[]
}

model PrintIssue {
  id            String           @id @default(cuid())
  name          String
  publicationId String
  publication   PrintPublication @relation(fields: [publicationId], references: [id], onDelete: Cascade)
  issueDate     DateTime?
  isActive      Boolean          @default(true)
  createdAt     DateTime         @default(now())
  updatedAt     DateTime         @updatedAt

  stories PrintStory[]

  @@unique([name, publicationId])
}

// Web Stories
model WebStory {
  id                String          @id @default(cuid())
  title             String
  slug              String          @unique
  content           String?         @db.Text
  summary           String?         @db.Text
  author            String?
  sourceUrl         String?
  keywords          String?
  date              DateTime
  publicationId     String?
  publication       WebPublication? @relation(fields: [publicationId], references: [id])
  industryId        String?
  industry          Industry?       @relation(fields: [industryId], references: [id])
  createdById       String?
  createdBy         User?           @relation(fields: [createdById], references: [id])
  createdAt         DateTime        @default(now())
  updatedAt         DateTime        @updatedAt
  sentimentPositive Float?
  sentimentNeutral  Float?
  sentimentNegative Float?
  overallSentiment  String?

  subIndustries WebStorySubIndustry[]
  images        WebStoryImage[]
}

model WebStorySubIndustry {
  id            String      @id @default(cuid())
  webStoryId    String
  webStory      WebStory    @relation(fields: [webStoryId], references: [id], onDelete: Cascade)
  subIndustryId String
  subIndustry   SubIndustry @relation(fields: [subIndustryId], references: [id], onDelete: Cascade)

  @@unique([webStoryId, subIndustryId])
}

model WebStoryImage {
  id         String   @id @default(cuid())
  webStoryId String
  webStory   WebStory @relation(fields: [webStoryId], references: [id], onDelete: Cascade)
  url        String
  caption    String?
  createdAt  DateTime @default(now())
}

// TV Stories
model TVStory {
  id                String     @id @default(cuid())
  title             String
  slug              String     @unique
  content           String?    @db.Text
  summary           String?    @db.Text
  presenters        String?
  keywords          String?
  videoUrl          String?
  videoTitle        String?
  date              DateTime
  stationId         String?
  station           TVStation? @relation(fields: [stationId], references: [id])
  programId         String?
  program           TVProgram? @relation(fields: [programId], references: [id])
  industryId        String?
  industry          Industry?  @relation(fields: [industryId], references: [id])
  createdById       String?
  createdBy         User?      @relation(fields: [createdById], references: [id])
  createdAt         DateTime   @default(now())
  updatedAt         DateTime   @updatedAt
  sentimentPositive Float?
  sentimentNeutral  Float?
  sentimentNegative Float?
  overallSentiment  String?

  subIndustries TVStorySubIndustry[]
}

model TVStorySubIndustry {
  id            String      @id @default(cuid())
  tvStoryId     String
  tvStory       TVStory     @relation(fields: [tvStoryId], references: [id], onDelete: Cascade)
  subIndustryId String
  subIndustry   SubIndustry @relation(fields: [subIndustryId], references: [id], onDelete: Cascade)

  @@unique([tvStoryId, subIndustryId])
}

// Radio Stories
model RadioStory {
  id                String        @id @default(cuid())
  title             String
  slug              String        @unique
  content           String?       @db.Text
  summary           String?       @db.Text
  presenters        String?
  keywords          String?
  audioUrl          String?
  audioTitle        String?
  date              DateTime
  stationId         String?
  station           RadioStation? @relation(fields: [stationId], references: [id])
  programId         String?
  program           RadioProgram? @relation(fields: [programId], references: [id])
  industryId        String?
  industry          Industry?     @relation(fields: [industryId], references: [id])
  createdById       String?
  createdBy         User?         @relation(fields: [createdById], references: [id])
  createdAt         DateTime      @default(now())
  updatedAt         DateTime      @updatedAt
  sentimentPositive Float?
  sentimentNeutral  Float?
  sentimentNegative Float?
  overallSentiment  String?

  subIndustries RadioStorySubIndustry[]
}

model RadioStorySubIndustry {
  id            String      @id @default(cuid())
  radioStoryId  String
  radioStory    RadioStory  @relation(fields: [radioStoryId], references: [id], onDelete: Cascade)
  subIndustryId String
  subIndustry   SubIndustry @relation(fields: [subIndustryId], references: [id], onDelete: Cascade)

  @@unique([radioStoryId, subIndustryId])
}

// Print Stories
model PrintStory {
  id                String            @id @default(cuid())
  title             String
  slug              String            @unique
  content           String?           @db.Text
  summary           String?           @db.Text
  author            String?
  pageNumbers       String?
  keywords          String?
  date              DateTime
  publicationId     String?
  publication       PrintPublication? @relation(fields: [publicationId], references: [id])
  issueId           String?
  issue             PrintIssue?       @relation(fields: [issueId], references: [id])
  industryId        String?
  industry          Industry?         @relation(fields: [industryId], references: [id])
  createdById       String?
  createdBy         User?             @relation(fields: [createdById], references: [id])
  createdAt         DateTime          @default(now())
  updatedAt         DateTime          @updatedAt
  sentimentPositive Float?
  sentimentNeutral  Float?
  sentimentNegative Float?
  overallSentiment  String?

  subIndustries PrintStorySubIndustry[]
  images        PrintStoryImage[]
}

model PrintStorySubIndustry {
  id            String      @id @default(cuid())
  printStoryId  String
  printStory    PrintStory  @relation(fields: [printStoryId], references: [id], onDelete: Cascade)
  subIndustryId String
  subIndustry   SubIndustry @relation(fields: [subIndustryId], references: [id], onDelete: Cascade)

  @@unique([printStoryId, subIndustryId])
}

model PrintStoryImage {
  id           String     @id @default(cuid())
  printStoryId String
  printStory   PrintStory @relation(fields: [printStoryId], references: [id], onDelete: Cascade)
  url          String
  caption      String?
  createdAt    DateTime   @default(now())
}

// Logging Models
model ArticleViewLog {
  id           String    @id @default(cuid())
  clientId     String
  client       Client    @relation(fields: [clientId], references: [id], onDelete: Cascade)
  userId       String
  user         User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  articleId    String
  articleTitle String
  mediaType    MediaType
  duration     Int       @default(0) // seconds
  viewedAt     DateTime  @default(now())

  @@index([clientId])
  @@index([userId])
  @@index([viewedAt(sort: Desc)])
  @@index([mediaType])
}

model MediaEntryLog {
  id         String    @id @default(cuid())
  userId     String
  user       User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  mediaType  MediaType
  publisher  String
  storyId    String
  storyTitle String
  action     String    // 'created', 'updated', 'deleted'
  timestamp  DateTime  @default(now())

  @@index([userId])
  @@index([mediaType])
  @@index([publisher])
  @@index([timestamp(sort: Desc)])
  @@index([action])
}

model EmailLog {
  id           String     @id @default(cuid())
  recipient    String
  subject      String
  articleId    String?
  articleType  MediaType?
  status       String     // 'sent', 'failed'
  errorMessage String?
  sentAt       DateTime   @default(now())

  @@index([status])
  @@index([sentAt(sort: Desc)])
  @@index([recipient])
}

model VisitLog {
  id        String     @id @default(cuid())
  userId    String?
  user      User?      @relation(fields: [userId], references: [id], onDelete: SetNull)
  ipAddress String
  userAgent String?
  page      String
  articleId String?
  mediaType MediaType?
  visitedAt DateTime   @default(now())

  @@index([userId])
  @@index([visitedAt(sort: Desc)])
  @@index([page])
  @@index([ipAddress])
}

model TenderViewLog {
  id          String   @id @default(cuid())
  userId      String
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  tenderId    String
  tenderTitle String?
  viewedAt    DateTime @default(now())

  @@index([userId])
  @@index([tenderId])
  @@index([viewedAt(sort: Desc)])
}

enum DailyInsightStatus {
  pending
  accepted
  archived
}

enum SocialPlatform {
  TWITTER
  FACEBOOK
  INSTAGRAM
  LINKEDIN
  YOUTUBE
  TIKTOK
}

// Social Media Account (source tracking)
model SocialAccount {
  id             String         @id @default(cuid())
  platform       SocialPlatform
  handle         String
  displayName    String?
  profileUrl     String?
  avatarUrl      String?
  followersCount Int?           @default(0)
  isVerified     Boolean        @default(false)
  isActive       Boolean        @default(true)
  createdAt      DateTime       @default(now())
  updatedAt      DateTime       @updatedAt

  posts SocialPost[]

  @@unique([platform, handle])
}

// Social Media Post
model SocialPost {
  id               String         @id @default(cuid())
  platform         SocialPlatform
  postId           String         // Platform-specific post ID
  content          String?        @db.Text
  summary          String?        @db.Text
  authorHandle     String?
  authorName       String?
  authorAvatarUrl  String?
  postUrl          String         // Direct link to post
  embedUrl         String?        // oEmbed URL if available
  embedHtml        String?        @db.Text // Embed HTML code
  mediaUrls        String[]       // Images/videos in post
  mediaType        String?        // image, video, carousel, etc.
  likesCount       Int?           @default(0)
  commentsCount    Int?           @default(0)
  sharesCount      Int?           @default(0)
  viewsCount       Int?           @default(0)
  hashtags         String[]
  mentions         String[]
  keywords         String?
  postedAt         DateTime
  accountId        String?
  account          SocialAccount? @relation(fields: [accountId], references: [id])
  clientId         String?
  client           Client?        @relation(fields: [clientId], references: [id], onDelete: SetNull)
  industryId       String?
  industry         Industry?      @relation(fields: [industryId], references: [id])
  createdById      String?
  createdBy        User?          @relation(fields: [createdById], references: [id])
  sentimentPositive Float?
  sentimentNeutral  Float?
  sentimentNegative Float?
  overallSentiment  String?
  createdAt        DateTime       @default(now())
  updatedAt        DateTime       @updatedAt

  subIndustries SocialPostSubIndustry[]

  @@unique([platform, postId, clientId])
  @@index([platform])
  @@index([postedAt(sort: Desc)])
  @@index([accountId])
  @@index([clientId])
}

model SocialPostSubIndustry {
  id            String      @id @default(cuid())
  socialPostId  String
  socialPost    SocialPost  @relation(fields: [socialPostId], references: [id], onDelete: Cascade)
  subIndustryId String
  subIndustry   SubIndustry @relation(fields: [subIndustryId], references: [id], onDelete: Cascade)

  @@unique([socialPostId, subIndustryId])
}

// Crawler Source Configuration
model CrawlerSource {
  id             String    @id @default(cuid())
  name           String
  url            String    @unique
  sourceType     String    @default("news") // news, social, rss
  industry       String    @default("general")
  isActive       Boolean   @default(true)
  crawlFrequency Int       @default(60) // minutes
  lastCrawledAt  DateTime?
  articlesFound  Int       @default(0)
  errorCount     Int       @default(0)
  lastError      String?
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt

  logs CrawlerLog[]
}

// Crawler Configuration Settings
model CrawlerConfig {
  id          String   @id @default(cuid())
  key         String   @unique
  value       String   @db.Text
  description String?
  category    String   @default("general") // general, performance, social, notifications
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

// Crawler Execution Logs
model CrawlerLog {
  id            String         @id @default(cuid())
  sourceId      String?
  source        CrawlerSource? @relation(fields: [sourceId], references: [id])
  sourceName    String
  sourceUrl     String
  status        String         // running, success, error
  articlesFound Int            @default(0)
  articlesSaved Int            @default(0)
  duration      Int            @default(0) // seconds
  errorMessage  String?
  startedAt     DateTime       @default(now())
  completedAt   DateTime?

  @@index([sourceId])
  @@index([startedAt(sort: Desc)])
}

model DailyInsight {
  id        String   @id @default(cuid())
  title     String
  url       String
  description String?
  source    String?
  industry  String   @default("general")
  
  clientId  String?
  client    Client?  @relation(fields: [clientId], references: [id], onDelete: SetNull)
  
  status    DailyInsightStatus @default(pending)
  scrapedAt DateTime @default(now())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([url, clientId])
  @@index([clientId])
  @@index([status])
  @@index([scrapedAt(sort: Desc)])
  @@index([industry])
}

// System Settings
model SystemSetting {
  id        String   @id @default(cuid())
  key       String   @unique
  value     String   @db.Text
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}
